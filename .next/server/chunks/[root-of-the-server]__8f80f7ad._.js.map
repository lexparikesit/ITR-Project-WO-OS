{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///C:/Project/web-ops/src/app/api/auth/login/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\n\r\ntype LoginBody = { username?: string; password?: string };\r\n\r\nexport async function POST(req: Request) {\r\n  const body = (await req.json()) as LoginBody;\r\n\r\n  if (!body?.username || !body?.password) {\r\n    return NextResponse.json({ success: false, message: \"Missing credentials\" }, { status: 400 });\r\n  }\r\n\r\n  const base = process.env.WAREHOUSE_API_BASE;\r\n  if (!base) {\r\n    return NextResponse.json({ success: false, message: \"WAREHOUSE_API_BASE missing\" }, { status: 500 });\r\n  }\r\n\r\n  const url = new URL(\"/auth/login\", base); // sesuai Postman kamu\r\n\r\n  try {\r\n    const upstream = await fetch(url, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        \"Accept\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({ username: body.username, password: body.password }),\r\n      cache: \"no-store\",\r\n    });\r\n\r\n    const rawText = await upstream.text();\r\n    let json: any;\r\n    try { json = JSON.parse(rawText); } catch { json = rawText; }\r\n\r\n    if (!upstream.ok || !json?.success) {\r\n      // ‚Üê kirim balik detail upstream biar kebaca di UI\r\n      return NextResponse.json(\r\n        {\r\n          success: false,\r\n          message: json?.message || \"Upstream login failed\",\r\n          upstreamStatus: upstream.status,\r\n          upstreamBody: json,\r\n          endpoint: url.toString(),\r\n        },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const wtoken: string | undefined = json?.accessToken;\r\n    if (!wtoken) {\r\n      return NextResponse.json({ success: false, message: \"No accessToken in upstream response\" }, { status: 500 });\r\n    }\r\n\r\n    const displayName = json?.user?.name || json?.user?.username || body.username;\r\n\r\n    // token dummy untuk guard lokal\r\n    const appPayload = {\r\n      sub: json?.user?.id ?? body.username,\r\n      name: displayName,\r\n      iat: Math.floor(Date.now() / 1000),\r\n      exp: Math.floor(Date.now() / 1000) + 60 * 60 * 8,\r\n    };\r\n    const appToken = Buffer.from(JSON.stringify(appPayload)).toString(\"base64url\");\r\n\r\n    const res = NextResponse.json({\r\n      success: true,\r\n      user: { id: json?.user?.id, username: json?.user?.username, name: displayName, email: json?.user?.email },\r\n    });\r\n\r\n    res.cookies.set(\"token\", appToken, {\r\n      httpOnly: true,\r\n      sameSite: \"lax\",\r\n      secure: process.env.NODE_ENV === \"production\",\r\n      path: \"/\",\r\n      maxAge: 60 * 60 * 8,\r\n    });\r\n\r\n    res.cookies.set(\"wtoken\", wtoken, {\r\n      httpOnly: true,\r\n      sameSite: \"lax\",\r\n      secure: process.env.NODE_ENV === \"production\",\r\n      path: \"/\",\r\n      maxAge: 60 * 60 * 8,\r\n    });\r\n\r\n    return res;\r\n  } catch (err: any) {\r\n    return NextResponse.json(\r\n      { success: false, message: err?.message || \"Fetch error to upstream\", endpoint: url.toString() },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAIO,eAAe,KAAK,GAAY;IACrC,MAAM,OAAQ,MAAM,IAAI,IAAI;IAE5B,IAAI,CAAC,MAAM,YAAY,CAAC,MAAM,UAAU;QACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,SAAS;QAAsB,GAAG;YAAE,QAAQ;QAAI;IAC7F;IAEA,MAAM,OAAO,QAAQ,GAAG,CAAC,kBAAkB;IAC3C,IAAI,CAAC,MAAM;QACT,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,SAAS;QAA6B,GAAG;YAAE,QAAQ;QAAI;IACpG;IAEA,MAAM,MAAM,IAAI,IAAI,eAAe,OAAO,sBAAsB;IAEhE,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,KAAK;YAChC,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,UAAU;YACZ;YACA,MAAM,KAAK,SAAS,CAAC;gBAAE,UAAU,KAAK,QAAQ;gBAAE,UAAU,KAAK,QAAQ;YAAC;YACxE,OAAO;QACT;QAEA,MAAM,UAAU,MAAM,SAAS,IAAI;QACnC,IAAI;QACJ,IAAI;YAAE,OAAO,KAAK,KAAK,CAAC;QAAU,EAAE,OAAM;YAAE,OAAO;QAAS;QAE5D,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,MAAM,SAAS;YAClC,kDAAkD;YAClD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,SAAS,MAAM,WAAW;gBAC1B,gBAAgB,SAAS,MAAM;gBAC/B,cAAc;gBACd,UAAU,IAAI,QAAQ;YACxB,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,SAA6B,MAAM;QACzC,IAAI,CAAC,QAAQ;YACX,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,SAAS;YAAsC,GAAG;gBAAE,QAAQ;YAAI;QAC7G;QAEA,MAAM,cAAc,MAAM,MAAM,QAAQ,MAAM,MAAM,YAAY,KAAK,QAAQ;QAE7E,gCAAgC;QAChC,MAAM,aAAa;YACjB,KAAK,MAAM,MAAM,MAAM,KAAK,QAAQ;YACpC,MAAM;YACN,KAAK,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;YAC7B,KAAK,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK,QAAQ,KAAK,KAAK;QACjD;QACA,MAAM,WAAW,OAAO,IAAI,CAAC,KAAK,SAAS,CAAC,aAAa,QAAQ,CAAC;QAElE,MAAM,MAAM,gJAAY,CAAC,IAAI,CAAC;YAC5B,SAAS;YACT,MAAM;gBAAE,IAAI,MAAM,MAAM;gBAAI,UAAU,MAAM,MAAM;gBAAU,MAAM;gBAAa,OAAO,MAAM,MAAM;YAAM;QAC1G;QAEA,IAAI,OAAO,CAAC,GAAG,CAAC,SAAS,UAAU;YACjC,UAAU;YACV,UAAU;YACV,QAAQ,oDAAyB;YACjC,MAAM;YACN,QAAQ,KAAK,KAAK;QACpB;QAEA,IAAI,OAAO,CAAC,GAAG,CAAC,UAAU,QAAQ;YAChC,UAAU;YACV,UAAU;YACV,QAAQ,oDAAyB;YACjC,MAAM;YACN,QAAQ,KAAK,KAAK;QACpB;QAEA,OAAO;IACT,EAAE,OAAO,KAAU;QACjB,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,SAAS,KAAK,WAAW;YAA2B,UAAU,IAAI,QAAQ;QAAG,GAC/F;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}