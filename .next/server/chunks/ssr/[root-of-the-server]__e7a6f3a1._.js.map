{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///C:/Project/web-ops/src/app/cases/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useMemo, useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport { keepPreviousData, useQuery } from \"@tanstack/react-query\";\r\nimport {\r\n  Container,\r\n  Stack,\r\n  Title,\r\n  Paper,\r\n  Group,\r\n  TextInput,\r\n  Button,\r\n  Loader,\r\n} from \"@mantine/core\";\r\nimport { useDebouncedValue } from \"@mantine/hooks\";\r\nimport {\r\n  DataTable,\r\n  type DataTableSortStatus,\r\n  type DataTableColumn,\r\n} from \"mantine-datatable\";\r\nimport { IconSearch } from \"@tabler/icons-react\";\r\n\r\ntype Row = {\r\n  id: string;\r\n  caseId: string;\r\n  description: string;\r\n  deliveryName: string;\r\n  deviceNumber: string;\r\n  serialNumber: string | null;\r\n  brand: string | null;\r\n  createdAt: string | null;\r\n  ageing: number | null;\r\n  ageingType: string;\r\n  warehouseName: string;\r\n  siteName: string;\r\n  statusWo: string;\r\n  site: string;\r\n  warehouse: string;\r\n};\r\n\r\ntype Resp = { data: Row[]; page: number; limit: number; total: number };\r\n\r\nexport default function CasesPage() {\r\n  // search\r\n  const [q, setQ] = useState(\"\");\r\n  const [qDebounced] = useDebouncedValue(q, 400);\r\n\r\n  // paging\r\n  const [page, setPage] = useState(1);\r\n  const [limit, setLimit] = useState(50);\r\n\r\n  // sorting\r\n  const [sortStatus, setSortStatus] = useState<DataTableSortStatus<Row>>({\r\n    columnAccessor: \"createdAt\",\r\n    direction: \"desc\",\r\n  });\r\n\r\n  // filter lain (kalau nanti diperlukan bisa dijadikan state)\r\n  const caseId = \"\";\r\n  const ageingType = \"ALL\";\r\n  const site = \"ALL\";\r\n\r\n  const queryKey = useMemo(\r\n    () =>\r\n      [\r\n        \"cases\",\r\n        { q: qDebounced, page, limit, sort: sortStatus, caseId, ageingType, site },\r\n      ] as const,\r\n    [qDebounced, page, limit, sortStatus, caseId, ageingType, site]\r\n  );\r\n\r\n  const { data, isLoading, isFetching } = useQuery<Resp>({\r\n    queryKey,\r\n    queryFn: async () => {\r\n      const res = await axios.get<Resp>(\"/api/cases\", {\r\n        params: {\r\n          q: qDebounced,\r\n          page,\r\n          limit,\r\n          caseId,\r\n          ageingType,\r\n          site,\r\n          orderBy: sortStatus.columnAccessor,\r\n          orderDir: sortStatus.direction,\r\n        },\r\n      });\r\n      return res.data;\r\n    },\r\n    placeholderData: keepPreviousData,\r\n    refetchOnWindowFocus: false,\r\n    refetchOnReconnect: false,\r\n    staleTime: 5 * 60 * 1000,\r\n    // biar gak “kedip” saat refetch\r\n    notifyOnChangeProps: [\"data\", \"error\"],\r\n  });\r\n\r\n  // ---- state tampilan tabel\r\n  const loading = isLoading || isFetching;\r\n  const rows = data?.data ?? [];\r\n  // ⬇️ kunci: jangan biarkan totalRecords = 0 waktu records ada\r\n  const totalDerived = Math.max(data?.total ?? 0, rows.length);\r\n  const hasRows = rows.length > 0;\r\n  const isInitialLoading = loading && !data;\r\n\r\n  const columns: DataTableColumn<Row>[] = [\r\n    { accessor: \"caseId\", title: \"WO ID\", width: 140, sortable: true },\r\n    { accessor: \"description\", title: \"Description\", width: 260, sortable: true },\r\n    { accessor: \"deliveryName\", title: \"Customer\", width: 220, sortable: true },\r\n    { accessor: \"deviceNumber\", title: \"Device\", width: 160, sortable: true },\r\n    { accessor: \"brand\", title: \"Brand\", width: 120, sortable: true },\r\n    { accessor: \"ageingType\", title: \"Aging\", width: 100, sortable: true },\r\n    { accessor: \"warehouseName\", title: \"Warehouse\", width: 200, sortable: true },\r\n    { accessor: \"siteName\", title: \"Site\", width: 160, sortable: true },\r\n    { accessor: \"statusWo\", title: \"Status\", width: 120, sortable: true },\r\n    {\r\n      accessor: \"createdAt\",\r\n      title: \"Created\",\r\n      width: 180,\r\n      sortable: true,\r\n      render: (r) => (r.createdAt ? new Date(r.createdAt).toLocaleString() : \"-\"),\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <Container size=\"xl\" py=\"md\">\r\n      <Stack gap=\"md\">\r\n        <Title order={2}>WO Outstanding</Title>\r\n\r\n        <Paper p=\"md\" withBorder>\r\n          <Group align=\"end\" wrap=\"wrap\" gap=\"md\">\r\n            <TextInput\r\n              label=\"Search\"\r\n              placeholder=\"WO / device / site / warehouse / customer\"\r\n              leftSection={<IconSearch size={16} />}\r\n              value={q}\r\n              onChange={(e) => {\r\n                setQ(e.currentTarget.value);\r\n                setPage(1);\r\n              }}\r\n              style={{ minWidth: 500 }}\r\n            />\r\n            <Button\r\n              variant=\"dark\"\r\n              onClick={() => {\r\n                setQ(\"\");\r\n                setPage(1);\r\n                setLimit(50);\r\n                setSortStatus({ columnAccessor: \"createdAt\", direction: \"desc\" });\r\n              }}\r\n            >\r\n              Reset\r\n            </Button>\r\n          </Group>\r\n        </Paper>\r\n\r\n        <Paper p=\"md\" withBorder>\r\n          {isInitialLoading ? (\r\n            // ⬅️ TIDAK render DataTable saat load awal\r\n            <div style={{ display: \"flex\", minHeight: 300, alignItems: \"center\", justifyContent: \"center\" }}>\r\n              <Loader />\r\n            </div>\r\n          ) : !hasRows ? (\r\n            <div style={{ padding: 12 }}>Tidak ada data</div>\r\n          ) : (\r\n            // ⬇️ class ini untuk menyembunyikan empty-state bawaan\r\n            <div className=\"datatable-hide-empty\">\r\n              <DataTable<Row>\r\n                withTableBorder\r\n                highlightOnHover\r\n                fetching={loading}             // loader overlay saat refetch\r\n                records={rows}\r\n                idAccessor=\"id\"\r\n                columns={columns}\r\n                sortStatus={sortStatus}\r\n                onSortStatusChange={(s) => {\r\n                  setSortStatus(s);\r\n                  setPage(1);\r\n                }}\r\n                totalRecords={totalDerived}     // ⬅️ gunakan totalDerived\r\n                recordsPerPage={limit}\r\n                page={page}\r\n                onPageChange={setPage}\r\n                recordsPerPageOptions={[25, 50, 100, 200]}\r\n                onRecordsPerPageChange={(n) => {\r\n                  setLimit(n);\r\n                  setPage(1);\r\n                }}\r\n                paginationText={({ from, to, totalRecords }) =>\r\n                  `${from}–${to} dari ${totalRecords}`\r\n                }\r\n                minHeight={420}\r\n                // ⛔️ jangan kirim noRecordsText/noRecordsIcon\r\n              />\r\n            </div>\r\n          )}\r\n        </Paper>\r\n      </Stack>\r\n    </Container>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AACA;AAKA;AArBA;;;;;;;;;AA2Ce,SAAS;IACtB,SAAS;IACT,MAAM,CAAC,GAAG,KAAK,GAAG,IAAA,iNAAQ,EAAC;IAC3B,MAAM,CAAC,WAAW,GAAG,IAAA,yNAAiB,EAAC,GAAG;IAE1C,SAAS;IACT,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAC;IACjC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;IAEnC,UAAU;IACV,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAA2B;QACrE,gBAAgB;QAChB,WAAW;IACb;IAEA,4DAA4D;IAC5D,MAAM,SAAS;IACf,MAAM,aAAa;IACnB,MAAM,OAAO;IAEb,MAAM,WAAW,IAAA,gNAAO,EACtB,IACE;YACE;YACA;gBAAE,GAAG;gBAAY;gBAAM;gBAAO,MAAM;gBAAY;gBAAQ;gBAAY;YAAK;SAC1E,EACH;QAAC;QAAY;QAAM;QAAO;QAAY;QAAQ;QAAY;KAAK;IAGjE,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,UAAU,EAAE,GAAG,IAAA,uLAAQ,EAAO;QACrD;QACA,SAAS;YACP,MAAM,MAAM,MAAM,gJAAK,CAAC,GAAG,CAAO,cAAc;gBAC9C,QAAQ;oBACN,GAAG;oBACH;oBACA;oBACA;oBACA;oBACA;oBACA,SAAS,WAAW,cAAc;oBAClC,UAAU,WAAW,SAAS;gBAChC;YACF;YACA,OAAO,IAAI,IAAI;QACjB;QACA,iBAAiB,2LAAgB;QACjC,sBAAsB;QACtB,oBAAoB;QACpB,WAAW,IAAI,KAAK;QACpB,gCAAgC;QAChC,qBAAqB;YAAC;YAAQ;SAAQ;IACxC;IAEA,4BAA4B;IAC5B,MAAM,UAAU,aAAa;IAC7B,MAAM,OAAO,MAAM,QAAQ,EAAE;IAC7B,8DAA8D;IAC9D,MAAM,eAAe,KAAK,GAAG,CAAC,MAAM,SAAS,GAAG,KAAK,MAAM;IAC3D,MAAM,UAAU,KAAK,MAAM,GAAG;IAC9B,MAAM,mBAAmB,WAAW,CAAC;IAErC,MAAM,UAAkC;QACtC;YAAE,UAAU;YAAU,OAAO;YAAS,OAAO;YAAK,UAAU;QAAK;QACjE;YAAE,UAAU;YAAe,OAAO;YAAe,OAAO;YAAK,UAAU;QAAK;QAC5E;YAAE,UAAU;YAAgB,OAAO;YAAY,OAAO;YAAK,UAAU;QAAK;QAC1E;YAAE,UAAU;YAAgB,OAAO;YAAU,OAAO;YAAK,UAAU;QAAK;QACxE;YAAE,UAAU;YAAS,OAAO;YAAS,OAAO;YAAK,UAAU;QAAK;QAChE;YAAE,UAAU;YAAc,OAAO;YAAS,OAAO;YAAK,UAAU;QAAK;QACrE;YAAE,UAAU;YAAiB,OAAO;YAAa,OAAO;YAAK,UAAU;QAAK;QAC5E;YAAE,UAAU;YAAY,OAAO;YAAQ,OAAO;YAAK,UAAU;QAAK;QAClE;YAAE,UAAU;YAAY,OAAO;YAAU,OAAO;YAAK,UAAU;QAAK;QACpE;YACE,UAAU;YACV,OAAO;YACP,OAAO;YACP,UAAU;YACV,QAAQ,CAAC,IAAO,EAAE,SAAS,GAAG,IAAI,KAAK,EAAE,SAAS,EAAE,cAAc,KAAK;QACzE;KACD;IAED,qBACE,8OAAC,8LAAS;QAAC,MAAK;QAAK,IAAG;kBACtB,cAAA,8OAAC,kLAAK;YAAC,KAAI;;8BACT,8OAAC,kLAAK;oBAAC,OAAO;8BAAG;;;;;;8BAEjB,8OAAC,kLAAK;oBAAC,GAAE;oBAAK,UAAU;8BACtB,cAAA,8OAAC,kLAAK;wBAAC,OAAM;wBAAM,MAAK;wBAAO,KAAI;;0CACjC,8OAAC,8LAAS;gCACR,OAAM;gCACN,aAAY;gCACZ,2BAAa,8OAAC,wOAAU;oCAAC,MAAM;;;;;;gCAC/B,OAAO;gCACP,UAAU,CAAC;oCACT,KAAK,EAAE,aAAa,CAAC,KAAK;oCAC1B,QAAQ;gCACV;gCACA,OAAO;oCAAE,UAAU;gCAAI;;;;;;0CAEzB,8OAAC,qLAAM;gCACL,SAAQ;gCACR,SAAS;oCACP,KAAK;oCACL,QAAQ;oCACR,SAAS;oCACT,cAAc;wCAAE,gBAAgB;wCAAa,WAAW;oCAAO;gCACjE;0CACD;;;;;;;;;;;;;;;;;8BAML,8OAAC,kLAAK;oBAAC,GAAE;oBAAK,UAAU;8BACrB,mBACC,2CAA2C;kCAC3C,8OAAC;wBAAI,OAAO;4BAAE,SAAS;4BAAQ,WAAW;4BAAK,YAAY;4BAAU,gBAAgB;wBAAS;kCAC5F,cAAA,8OAAC,qLAAM;;;;;;;;;+BAEP,CAAC,wBACH,8OAAC;wBAAI,OAAO;4BAAE,SAAS;wBAAG;kCAAG;;;;;+BAE7B,uDAAuD;kCACvD,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC,mKAAS;4BACR,eAAe;4BACf,gBAAgB;4BAChB,UAAU;4BACV,SAAS;4BACT,YAAW;4BACX,SAAS;4BACT,YAAY;4BACZ,oBAAoB,CAAC;gCACnB,cAAc;gCACd,QAAQ;4BACV;4BACA,cAAc;4BACd,gBAAgB;4BAChB,MAAM;4BACN,cAAc;4BACd,uBAAuB;gCAAC;gCAAI;gCAAI;gCAAK;6BAAI;4BACzC,wBAAwB,CAAC;gCACvB,SAAS;gCACT,QAAQ;4BACV;4BACA,gBAAgB,CAAC,EAAE,IAAI,EAAE,EAAE,EAAE,YAAY,EAAE,GACzC,GAAG,KAAK,CAAC,EAAE,GAAG,MAAM,EAAE,cAAc;4BAEtC,WAAW;;;;;;;;;;;;;;;;;;;;;;;;;;;AAS3B","debugId":null}}]
}